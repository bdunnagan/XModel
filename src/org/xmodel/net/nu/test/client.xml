<script>
  <package>org.xmodel.net.nu.xaction</package>

  <assign var="send">
    <script>
      <logi>'[CLIENT] Send'</logi>
      
      <!--register name="'bob'" via="$transport" timeout="10000"/-->
      
      <request var="result" via="$client" timeout="60000">
        <script>
          <print>'Hi, Server'</print>
        </script>
      </request>
    </script>
  </assign>

  <assign var="onReceive">
    <script in="transport, message">
      <logi>format( '[CLIENT] Received:\n%s', $message)</logi>
    </script>
  </assign>

  <assign var="onError">
    <script in="transport, error">
      <logi>format( '[CLIENT] Error: %s', $error)</logi>
    </script>
  </assign>

  <assign var="onConnect">
    <script in="transport">
      <logi>'[CLIENT] Connected'</logi>
      <run>$send</run>
    </script>
  </assign>
  
  <assign var="onDisconnect">
    <script in="transport">
      <logi>'[CLIENT] Disconnected'</logi>
    </script>
  </assign>

  <!--amqpClient var="client" amqpHost="'127.0.0.1'" amqpPort="5672" connectTimeout="3000">
    <publishQueue>'server_recv'</publishQueue>
    <consumeQueue>'client_recv'</consumeQueue>
    <onConnect>$onConnect</onConnect>
    <onDisconnect>$onDisconnect</onDisconnect>
    <onReceive>$onReceive</onReceive>
    <onError>$onError</onError>
  </amqpClient-->
  
  <tcpClient var="client" remoteHost="'192.168.1.4'" remotePort="10000" connectTimeout="3000">
    <heartbeatPeriod>100000</heartbeatPeriod>
    <heartbeatTimeout>300000</heartbeatTimeout>
    <onConnect>$onConnect</onConnect>
    <onDisconnect>$onDisconnect</onDisconnect>
    <onReceive>$onReceive</onReceive>
    <onError>$onError</onError>
  </tcpClient>
  
  <sleep>60000</sleep>
</script>
